<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="../css/book-list.css">
    <title>Book List</title>
</head>
<body>
    <div class="container">
        <div class="left-side">
            <h2>Xin chào, @Name</h2>
            <nav>
                <ul>
                    <li><img src="/image/icon-home.svg"><a href="#">Trang chủ</a></li>
                    <li><img src="/image/icon-book.svg"><a href="#">Sách</a></li>
                    <li><img src="/image/icon-report.svg"><a href="#">Báo cáo</a></li>
                    <li><img src="/image/icon-log-out.svg"><a href="#">Đăng xuất</a></li>
                </ul>                
            </nav>
        </div>
        <div class="right-side">
            <section class="edit-book">
                <div class="header">
                    <div class="back">
                        <img class="icon-back" src="/image/icon-list.svg" alt="Back" id="back-button" onclick="goBack()">
                        <h3>Danh sách sách</h3>
                    </div>
                    <button type="submit" class="add-page-button" onclick="window.location.href='book-add.html'">Thêm sách</button>
                    <button type="submit" class="export-book-list-button">Xuất danh sách sách</button>
                    <script src="../js/main.js"></script>
                    <div class="search-box">
                        <img src="/image/icon-search.svg" alt="Search Icon" class="search-icon">
                        <input type="text" placeholder="Tìm kiếm..." id="search-input" oninput="searchBooks()">
                    </div>
                </div>                
                <div class="line"></div>
                <div class="main-content">
                    <div class="left-side-content">
                        <div id="container">
                            <h3>Upload file using firebase</h3>
                            <input type="file" id="fileButton" name="">
                            <progress id="progressBar" value="0" max="100" style="width:300px;"></progress>
                        
                            <div id="photo-container" class="book-image">
                                <img id="photo" src="/image/book-image.png" alt="Book Image 1" class="book-image">
                            </div>             
                        </div>  
                    </div>                
                </div>
            </section>
        </div>
    </div>
    <script src="../js/main.js"></script>
    <script type="module">
        // Import the functions you need from the SDKs you need
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
        import { getDatabase, ref, set } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-database.js";
        import { getAnalytics } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-analytics.js";
        import { getStorage, ref as storageRef, uploadBytesResumable, getDownloadURL } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-storage.js";
    
        // Your web app's Firebase configuration
        const firebaseConfig = {
            apiKey: "AIzaSyCS7Td5JGz4eNmpRUblaq87ZGJo0j6JDnk",
            authDomain: "erudite-realm-330607.firebaseapp.com",
            databaseURL: "https://erudite-realm-330607-default-rtdb.firebaseio.com",
            projectId: "erudite-realm-330607",
            storageBucket: "erudite-realm-330607.appspot.com",
            messagingSenderId: "263875298921",
            appId: "1:263875298921:web:b36cdc114fee96cf4704f8",
            measurementId: "G-N6ZMKN5974"
        };
    
        // Initialize Firebase
        const app = initializeApp(firebaseConfig);
        const analytics = getAnalytics(app);
        const db = getDatabase(app);
        const storage = getStorage(app);
    
        var initApp = function() {
            const fileButton = document.getElementById('fileButton');

            if (fileButton) {
                fileButton.addEventListener('change', function(e) {
                    uploadFile(e.target.files[0]);
                });
            }
        };

        function uploadFile(file) {
            // Create the file metadata
            const metadata = {
                contentType: 'image/jpeg',
            };
            const storageReference = storageRef(storage, 'img/' + Date.now());
            const uploadTask = uploadBytesResumable(storageReference, file, metadata);

            // Listen for state changes, errors, and completion of the upload.
            uploadTask.on('state_changed',
                function(snapshot) {
                    // Get task progress, including the number of bytes uploaded and the total number of bytes to be uploaded
                    const progress = (snapshot.bytesTransferred / snapshot.totalBytes) * 100;
                    document.getElementById('progressBar').value = progress;
                    console.log('Upload is ' + progress + '% done');
                    switch (snapshot.state) {
                        case 'paused':
                            console.log('Upload is paused');
                            break;
                        case 'running':
                            console.log('Upload is running');
                            break;
                    }
                },
                function(error) {
                    // Handle unsuccessful uploads
                    console.error("Upload failed: ", error);
                },
                function() {
                    // Handle successful uploads on complete
                    getDownloadURL(uploadTask.snapshot.ref).then((downloadURL) => {
                        console.log('File available at', downloadURL);
                        const img = document.getElementById('photo');
                        img.src = downloadURL;
                    });
                }
            );
        }

        window.addEventListener('load', initApp);
    </script>
    
</body>

</html>
